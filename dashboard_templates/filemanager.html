{% extends "base.html" %}
{% block body %}
<style>
  /* ===========================================
     üìÅ Responsive File Manager + Delete Confirm
     =========================================== */

  h2 {
    animation: fadeIn 0.5s ease forwards;
    opacity: 0;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Toolbar */
  .fm-toolbar {
    margin-bottom: 16px;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    animation: fadeIn 0.6s ease forwards;
    opacity: 0;
  }

  .toolbar-btn {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 10px;
    font-size: 1.3rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  .toolbar-btn:hover {
    transform: scale(1.05);
    background: linear-gradient(145deg, #2b2f7a, #3c46ad);
    color: #fff;
  }

  /* Responsive Table Wrapper */
  .table-wrapper {
    width: 100%;
    overflow-x: auto;
    border-radius: 10px;
  }

  table {
    width: 100%;
    min-width: 700px;
    border-collapse: collapse;
    border-radius: 8px;
    overflow: hidden;
    animation: fadeInUp 0.5s ease forwards;
    opacity: 0;
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  thead {
    background: linear-gradient(90deg, #2b2f7a, #3842b1);
    color: #fff;
  }

  th, td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--border-color);
    text-align: left;
  }

  tbody tr:hover {
    background: rgba(107, 222, 255, 0.08);
  }

  .folder {
    color: #2b2f7a;
    font-weight: 600;
  }

  .file {
    color: var(--text-color);
  }

  .muted {
    color: #888;
    font-size: 0.9rem;
    text-align: center;
  }

  /* Action button */
  .action-btn {
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    background: #2b2f7a;
    color: #fff;
    font-size: 0.85rem;
    transition: all 0.2s ease;
  }

  .action-btn:hover {
    background: #4e5de6;
  }

  /* Breadcrumb */
  .breadcrumb {
    margin-bottom: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    font-size: 0.95rem;
    animation: fadeIn 0.6s ease forwards;
  }

  .breadcrumb a {
    color: #2b2f7a;
    text-decoration: none;
  }

  .breadcrumb a:hover {
    color: #0096c7;
  }

  /* Modals */
  .modal, .confirm-modal {
    display: none;
    position: fixed;
    z-index: 999;
    inset: 0;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
    animation: fadeIn 0.3s ease;
    padding: 15px;
  }

  .modal-content, .confirm-content {
    background: var(--card-bg);
    border-radius: 14px;
    padding: 25px 22px;
    width: 95%;
    max-width: 350px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    text-align: center;
    animation: scaleUp 0.3s ease;
    position: relative;
  }

  @keyframes scaleUp {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .modal-content h3, .confirm-content h3 {
    margin-bottom: 12px;
    font-size: 1.2rem;
  }

  .modal-content input {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 18px;
    font-size: 0.95rem;
    background: var(--bg-color);
    color: var(--text-color);
  }

  .modal-content input:focus {
    border-color: #2b2f7a;
    box-shadow: 0 0 0 2px rgba(43,47,122,0.2);
  }

  .modal-content button,
  .confirm-btn {
    width: 100%;
    padding: 10px 0;
    background: linear-gradient(90deg, #2b2f7a, #3842b1);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
  }

  .confirm-btn.cancel {
    background: var(--border-color);
    color: var(--text-color);
  }

  .confirm-btn.delete {
    background: linear-gradient(90deg, #d9534f, #b52b27);
  }

  .confirm-btn.delete:hover {
    background: linear-gradient(90deg, #b52b27, #d9534f);
  }

  .modal-content button:hover {
    background: linear-gradient(90deg, #3842b1, #2b2f7a);
  }

  .confirm-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  .modal-close {
    position: absolute;
    top: 12px;
    right: 16px;
    font-size: 1.3rem;
    color: #aaa;
    cursor: pointer;
  }

  .modal-close:hover {
    color: #333;
  }

  /* Responsive tweaks */
  @media (max-width: 600px) {
    h2 {
      font-size: 1.4rem;
    }
    th, td {
      font-size: 0.85rem;
      padding: 8px;
    }
    .action-btn {
      font-size: 0.75rem;
      padding: 5px 8px;
    }
    .toolbar-btn {
      font-size: 1.1rem;
      padding: 8px;
    }
  }

  a.edit-link {
    text-decoration: none;
    color: #2b2f7a;
    font-weight: 600;
  }

  body.dark a.edit-link {
    color: #7dafff;
  }
  
</style>

<h2>üìÇ File Manager</h2>

<div class="fm-toolbar">
  <button class="toolbar-btn" title="New File" onclick="openModal('file')">üìù</button>
  <button class="toolbar-btn" title="New Folder" onclick="openModal('folder')">üìÅ</button>
</div>

<div class="breadcrumb">
  <a href="{{ url_for('filemanager') }}">üè† Root</a>
  {% if current %}
    {% set parts = current.split('/') %}
    {% for i in range(parts|length) %}
      <span>‚Ä∫</span>
      {% set subpath = '/'.join(parts[:i+1]) %}
      {% if loop.last %}
        <span>{{ parts[i] }}</span>
      {% else %}
        <a href="{{ url_for('filemanager', subpath=subpath) }}">{{ parts[i] }}</a>
      {% endif %}
    {% endfor %}
  {% endif %}
</div>

<div class="table-wrapper">
<table>
  <thead>
    <tr><th>Name</th><th>Type</th><th>Size</th><th>Modified</th><th>Actions</th></tr>
  </thead>
  <tbody>
  {% for f in items %}
    <tr>
      {% if f.is_dir %}
        <td><a class="folder" href="{{ url_for('filemanager', subpath=(current ~ '/' if current else '') ~ f.name) }}">üìÅ {{ f.name }}</a></td>
        <td>Folder</td><td>-</td><td>{{ f.modified }}</td>
        <td>
          <button type="button" class="action-btn" onclick="confirmDelete('{{ f.name }}')">üóëÔ∏è Delete</button>
        </td>
      {% else %}
        <td><a class="file" href="{{ url_for('filemanager', subpath=(current ~ '/' if current else '') ~ f.name) }}">üìÑ {{ f.name }}</a></td>
        <td>File</td><td>{{ f.size }}</td><td>{{ f.modified }}</td>
        <td>
          {% set ext = f.name.split('.')[-1].lower() %}
          {% if ext in ['txt','json','py','yml','yaml','html','css','js','md'] %}
            <a href="{{ url_for('filemanager_edit', subpath=(current ~ '/' if current else '') ~ f.name) }}" class="edit-link">‚úèÔ∏è Edit</a> |
          {% endif %}
          <button type="button" class="action-btn" onclick="confirmDelete('{{ f.name }}')">üóëÔ∏è Delete</button>
        </td>
      {% endif %}
    </tr>
  {% endfor %}
  {% if items|length == 0 %}
    <tr><td colspan="5" class="muted">üì≠ Folder is empty</td></tr>
  {% endif %}
  </tbody>
</table>
</div>

<!-- Create Modal -->
<div id="createModal" class="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <h3 id="modalTitle">Create</h3>
    <form method="post" action="{{ url_for('filemanager_create') }}">
      <input type="hidden" name="current" value="{{ current }}">
      <input type="hidden" id="typeInput" name="type" value="">
      <input type="text" name="name" id="nameInput" placeholder="Enter name" required>
      <button type="submit">Create</button>
    </form>
  </div>
</div>

<!-- Confirm Delete Modal -->
<div id="confirmModal" class="confirm-modal">
  <div class="confirm-content">
    <h3>‚ö†Ô∏è Confirm Delete</h3>
    <p>This will permanently delete <b id="deleteName"></b>.<br>Your data cannot be recovered.</p>
    <div class="confirm-actions">
      <button class="confirm-btn cancel" onclick="closeConfirm()">Cancel</button>
      <form id="deleteForm" method="post" action="{{ url_for('filemanager_delete') }}">
        <input type="hidden" name="current" value="{{ current }}">
        <input type="hidden" id="deleteInput" name="name">
        <button type="submit" class="confirm-btn delete">Delete</button>
      </form>
    </div>
  </div>
</div>

<script>
  function openModal(type) {
    document.getElementById("createModal").style.display = "flex";
    document.getElementById("typeInput").value = type;
    document.getElementById("modalTitle").innerText = type === "folder" ? "üìÅ New Folder" : "üìù New File";
    document.getElementById("nameInput").placeholder = type === "folder" ? "Folder name" : "File name (e.g. readme.txt)";
  }

  function closeModal() {
    document.getElementById("createModal").style.display = "none";
  }

  function confirmDelete(name) {
    document.getElementById("confirmModal").style.display = "flex";
    document.getElementById("deleteInput").value = name;
    document.getElementById("deleteName").innerText = name;
  }

  function closeConfirm() {
    document.getElementById("confirmModal").style.display = "none";
  }

  window.onclick = function(event) {
    if (event.target === document.getElementById("createModal")) closeModal();
    if (event.target === document.getElementById("confirmModal")) closeConfirm();
  };

  window.addEventListener("load", () => {
    document.querySelectorAll("h2, .fm-toolbar, table, .breadcrumb").forEach(el => {
      el.style.opacity = "1";
      el.style.transform = "translateY(0)";
    });
  });
</script>
{% endblock %}
